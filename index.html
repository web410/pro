<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python Online Compiler</title>
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.36.1/min/vs/loader.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap');
        
        :root {
            --vscode-background: #1e1e1e;
            --vscode-editor-background: #1e1e1e;
            --vscode-sidebar-background: #252526;
            --vscode-panel-background: #1e1e1e;
            --vscode-text: #d4d4d4;
            --vscode-comment: #6a9955;
            --vscode-keyword: #569cd6;
            --vscode-string: #ce9178;
            --vscode-function: #dcdcaa;
            --vscode-number: #b5cea8;
            --vscode-class: #4ec9b0;
            --vscode-error: #f14c4c;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'JetBrains Mono', monospace;
            background-color: var(--vscode-background);
            color: var(--vscode-text);
            overflow: hidden;
        }

        .typing-animation {
            overflow: hidden;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .typing-cursor {
            display: inline-block;
            width: 10px;
            height: 1.2em;
            background-color: var(--vscode-text);
            animation: blink 1s infinite;
            vertical-align: text-bottom;
        }

        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        .error-line {
            color: var(--vscode-error) !important;
            background-color: rgba(241, 76, 76, 0.1);
            padding: 2px 4px;
            border-radius: 3px;
            margin: 2px 0;
        }

        .monaco-editor {
            font-family: 'JetBrains Mono', monospace !important;
        }

        .sidebar-item {
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .sidebar-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .sidebar-item.active {
            background-color: rgba(255, 255, 255, 0.15);
            border-left: 3px solid #007acc;
        }

        .panel-header {
            background-color: var(--vscode-sidebar-background);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .output-line {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .loading-spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid var(--vscode-text);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="app" class="flex h-screen">
        <!-- Left Sidebar -->
        <div class="w-16 bg-[var(--vscode-sidebar-background)] border-r border-[rgba(255,255,255,0.1)] flex flex-col">
            <div class="p-2 border-b border-[rgba(255,255,255,0.1)]">
                <button id="newFileBtn" class="sidebar-item w-full p-2 text-center hover:bg-[rgba(255,255,255,0.1)] rounded" title="New File">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            <div class="p-2 border-b border-[rgba(255,255,255,0.1)]">
                <button id="openFileBtn" class="sidebar-item w-full p-2 text-center hover:bg-[rgba(255,255,255,0.1)] rounded" title="Open File">
                    <i class="fas fa-folder-open"></i>
                </button>
            </div>
            <div class="p-2 border-b border-[rgba(255,255,255,0.1)]">
                <button id="saveFileBtn" class="sidebar-item w-full p-2 text-center hover:bg-[rgba(255,255,255,0.1)] rounded" title="Save File">
                    <i class="fas fa-save"></i>
                </button>
            </div>
            <div class="p-2 border-b border-[rgba(255,255,255,0.1)]">
                <button id="runBtn" class="sidebar-item w-full p-2 text-center hover:bg-[rgba(255,255,255,0.1)] rounded" title="Run">
                    <i class="fas fa-play"></i>
                </button>
            </div>
            <div class="p-2 border-b border-[rgba(255,255,255,0.1)]">
                <button id="stopBtn" class="sidebar-item w-full p-2 text-center hover:bg-[rgba(255,255,255,0.1)] rounded" title="Stop">
                    <i class="fas fa-stop"></i>
                </button>
            </div>
            <div class="p-2 border-b border-[rgba(255,255,255,0.1)]">
                <button id="settingsBtn" class="sidebar-item w-full p-2 text-center hover:bg-[rgba(255,255,255,0.1)] rounded" title="Settings">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </div>

        <!-- Main Editor Area -->
        <div class="flex-1 flex flex-col">
            <!-- Top Bar -->
            <div class="h-10 bg-[var(--vscode-sidebar-background)] border-b border-[rgba(255,255,255,0.1)] flex items-center px-4">
                <div class="flex items-center space-x-4">
                    <span class="text-sm font-medium">main.py</span>
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                        <span class="text-xs text-[var(--vscode-text)]">Python</span>
                    </div>
                </div>
                <div class="ml-auto flex items-center space-x-2">
                    <button id="minimizeBtn" class="p-1 hover:bg-[rgba(255,255,255,0.1)] rounded">
                        <i class="fas fa-minus text-xs"></i>
                    </button>
                    <button id="maximizeBtn" class="p-1 hover:bg-[rgba(255,255,255,0.1)] rounded">
                        <i class="fas fa-square text-xs"></i>
                    </button>
                    <button id="closeBtn" class="p-1 hover:bg-[rgba(255,255,255,0.1)] rounded">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                </div>
            </div>

            <!-- Editor Container -->
            <div id="editorContainer" class="flex-1"></div>
        </div>

        <!-- Right/Bottom Output Panel -->
        <div class="w-96 bg-[var(--vscode-panel-background)] border-l border-[rgba(255,255,255,0.1)] flex flex-col">
            <div class="panel-header px-4 py-2 flex items-center justify-between">
                <span class="text-sm font-medium">Output</span>
                <div class="flex items-center space-x-2">
                    <button id="clearOutputBtn" class="text-xs hover:text-[var(--vscode-text)]">
                        Clear
                    </button>
                    <button id="expandOutputBtn" class="text-xs hover:text-[var(--vscode-text)]">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
            <div id="outputPanel" class="flex-1 p-4 overflow-auto font-mono text-sm">
                <div class="text-gray-500">Output will appear here...</div>
            </div>
        </div>
    </div>

    <!-- Pyodide Script -->
    <script src="https://cdn.jsdelivr.net/npm/pyodide@0.24.1/full/pyodide.js"></script>
    
    <script>
        let editor;
        let pyodide;
        let isRunning = false;
        let outputElement;
        let typingInterval;
        let currentOutput = '';
        let pythonOutput = '';

        // Initialize the application
        async function initializeApp() {
            // Load Pyodide
            pyodide = await loadPyodide({
                indexURL: "https://cdn.jsdelivr.net/npm/pyodide@0.24.1/full/"
            });
            
            // Initialize Monaco Editor
            require.config({ paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.36.1/min/vs' }});
            require(['vs/editor/editor.main'], function() {
                editor = monaco.editor.create(document.getElementById('editorContainer'), {
                    value: `# Welcome to Python Online Compiler\nprint("Hello, World!")\n\n# Try running this code\nfor i in range(5):\n    print(f"Count: {i}")\n\n# You can also:\nname = input("Enter your name: ")\nprint(f"Hello, {name}!")`,
                    language: 'python',
                    theme: 'vs-dark',
                    automaticLayout: true,
                    minimap: { enabled: true },
                    fontSize: 14,
                    lineNumbers: 'on',
                    roundedSelection: false,
                    scrollBeyondLastLine: false,
                    readOnly: false,
                    cursorStyle: 'line',
                    wordWrap: 'on'
                });

                outputElement = document.getElementById('outputPanel');
            });
        }

        // Run button functionality
        document.getElementById('runBtn').addEventListener('click', async function() {
            if (isRunning) return;
            
            isRunning = true;
            this.classList.add('text-green-500');
            
            // Clear previous output
            outputElement.innerHTML = '';
            currentOutput = '';
            pythonOutput = '';
            
            // Get code from editor
            const code = editor.getValue();
            
            try {
                // Redirect Python output to our custom handler
                pyodide.runPython(`
                    import sys
                    from io import StringIO
                    
                    class StreamCapture:
                        def __init__(self):
                            self.buffer = StringIO()
                            self.original_stdout = sys.stdout
                            self.original_stderr = sys.stderr
                            
                        def write(self, data):
                            self.buffer.write(data)
                            # Also update the UI in real-time
                            window.pythonOutput += data
                            if window.typingInterval:
                                clearInterval(window.typingInterval)
                            window.typingInterval = setInterval(window.typeOutput, 30)
                            
                        def flush(self):
                            pass
                    
                    capture = StreamCapture()
                    sys.stdout = capture
                    sys.stderr = capture
                    
                    try:
                        exec("""${code.replace(/\\/g, '\\\\').replace(/"/g, '\\"')}""")
                    finally:
                        sys.stdout = capture.original_stdout
                        sys.stderr = capture.original_stderr
                `);
                
                // Start typing animation
                await typeOutput(pythonOutput);
                
            } catch (error) {
                displayError(error.toString());
            } finally {
                isRunning = false;
                this.classList.remove('text-green-500');
            }
        });

        // Stop button functionality
        document.getElementById('stopBtn').addEventListener('click', function() {
            if (typingInterval) {
                clearInterval(typingInterval);
                typingInterval = null;
            }
            isRunning = false;
            document.getElementById('runBtn').classList.remove('text-green-500');
        });

        // Clear output button
        document.getElementById('clearOutputBtn').addEventListener('click', function() {
            outputElement.innerHTML = '<div class="text-gray-500">Output will appear here...</div>';
            currentOutput = '';
            pythonOutput = '';
        });

        // Type output with animation
        async function typeOutput(text) {
            return new Promise(resolve => {
                let index = 0;
                const typingSpeed = 30; // milliseconds per character
                
                typingInterval = setInterval(() => {
                    if (index < text.length) {
                        const char = text[index];
                        currentOutput += char;
                        outputElement.innerHTML = currentOutput + '<span class="typing-cursor"></span>';
                        outputElement.scrollTop = outputElement.scrollHeight;
                        index++;
                    } else {
                        clearInterval(typingInterval);
                        typingInterval = null;
                        resolve();
                    }
                }, typingSpeed);
            });
        }

        // Display error with formatting
        function displayError(error) {
            const errorElement = document.createElement('div');
            errorElement.className = 'error-line mt-2';
            errorElement.textContent = `Error: ${error}`;
            outputElement.appendChild(errorElement);
            outputElement.scrollTop = outputElement.scrollHeight;
        }

        // New file functionality
        document.getElementById('newFileBtn').addEventListener('click', function() {
            const fileName = prompt('Enter file name (with .py extension):');
            if (fileName && fileName.endsWith('.py')) {
                currentFile = fileName;
                editor.setValue('');
                document.querySelector('.text-sm.font-medium').textContent = fileName;
            }
        });

        // Save file functionality (simulated)
        document.getElementById('saveFileBtn').addEventListener('click', function() {
            const code = editor.getValue();
            // In a real app, this would save to local storage
            localStorage.setItem('pythonCode', code);
            alert(`File "${currentFile}" saved successfully!`);
        });

        // Settings button (simulated)
        document.getElementById('settingsBtn').addEventListener('click', function() {
            alert('Settings panel would open here');
        });

        // Window controls (simulated)
        document.getElementById('minimizeBtn').addEventListener('click', function() {
            alert('Minimize functionality');
        });

        document.getElementById('maximizeBtn').addEventListener('click', function() {
            alert('Maximize functionality');
        });

        document.getElementById('closeBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to close?')) {
                window.close();
            }
        });

        // Initialize the app when the page loads
        window.addEventListener('load', initializeApp);
    </script>
</body>
</html>
